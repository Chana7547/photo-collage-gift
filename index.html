<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Zoom Collage Maker (Max Detail)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;600&display=swap');
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Prompt', sans-serif; background: #f8f9fa; 
            margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; 
        }

        .main-container { display: flex; gap: 25px; align-items: flex-start; max-width: 1400px; width: 100%; }

        /* ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° */
        .sidebar { 
            width: 380px; background: white; padding: 25px; border-radius: 20px; 
            box-shadow: 0 12px 30px rgba(0,0,0,0.08); border: 1px solid #edf2f7;
            position: sticky; top: 20px; z-index: 10;
        }

        .ui-group { margin-bottom: 18px; }
        label { font-weight: 700; display: block; margin-bottom: 8px; font-size: 15px; color: #4a5568; }
        select, input, button { width: 100%; padding: 14px; border-radius: 12px; border: 2px solid #e2e8f0; font-size: 15px; font-family: inherit; font-weight: 500; transition: 0.2s; }
        select:focus, input:focus { border-color: #3182ce; outline: none; }

        .btn-row { display: flex; gap: 10px; margin-bottom: 15px; }
        button { cursor: pointer; font-weight: 700; }
        button.btn-clear { background: #fff5f5; color: #c53030; border: 2px solid #feb2b2; }
        button.btn-shuffle { background: #ebf8ff; color: #2b6cb0; border: 2px solid #bee3f8; }
        button.btn-save { background: #1a202c; color: white; border: none; font-size: 18px; margin-top: 10px; padding: 16px; box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        button:active { transform: scale(0.98); }

        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß */
        .canvas-container { flex-grow: 1; display: flex; justify-content: center; width: 100%; overflow: hidden; background: #cbd5e0; border-radius: 16px; padding: 20px; border: 2px solid #e2e8f0; }

        /* --- ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏Ç‡∏ô‡∏≤‡∏î A4 ‡πÉ‡∏´‡∏ç‡πà‡∏Ñ‡∏π‡∏ì 2 (1190x1684) --- */
        #a4-canvas { 
            width: 1190px; height: 1684px;
            background-color: #ffffff !important; 
            display: flex; align-items: center; justify-content: center; 
            position: relative; box-shadow: 0 0 60px rgba(0,0,0,0.1); 
            transform-origin: top center;
            /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå */
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            image-rendering: high-quality;
        }

        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 125px) */
        .shape-grid { display: grid; grid-template-columns: repeat(7, 125px); grid-template-rows: repeat(9, 125px); gap: 15px; }
        
        .slot { width: 125px; height: 125px; background: transparent; }
        .slot.active { 
            background-color: #f8f9fa; border: 6px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-radius: 6px; 
            background-size: cover; background-position: center; 
            cursor: pointer; position: relative;
        }

        /* ‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏à‡∏≠ */
        @media (min-width: 1025px) { #a4-canvas { transform: scale(0.5); margin-bottom: -842px; } }
        @media (max-width: 1024px) {
            .main-container { flex-direction: column; }
            .sidebar { width: 100%; order: 2; }
            .canvas-container { order: 1; min-height: 550px; }
            #a4-canvas { transform: scale(0.35); margin-bottom: -1100px; }
        }
        @media (max-width: 500px) {
             #a4-canvas { transform: scale(0.25); margin-bottom: -1250px; }
             .canvas-container { min-height: 450px; padding: 10px; }
        }
    </style>
</head>
<body>

    <h2 style="margin: 10px 0 20px 0; text-align: center; font-weight: 800; color: #2d3748;">üîç Super Zoom Collage (‡∏ä‡∏±‡∏î‡∏ï‡∏≤‡πÅ‡∏ï‡∏Å)</h2>

    <div class="main-container">
        <div class="canvas-container"><div id="a4-canvas"><div class="shape-grid" id="gridContainer"></div></div></div>
        <div class="sidebar">
            <div style="background: #edf2f7; padding: 15px; border-radius: 12px; border-left: 5px solid #3182ce; margin-bottom: 20px; font-size: 14px; color: #2d3748;">
                üí° <b>‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î:</b><br>‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏¢‡∏¥‡πà‡∏á‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏ä‡∏±‡∏î ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏∞‡∏¢‡∏¥‡πà‡∏á‡∏ã‡∏π‡∏°‡πÑ‡∏î‡πâ‡πÑ‡∏Å‡∏•‡∏Ñ‡∏£‡∏±‡∏ö
            </div>
            <div class="ui-group">
                <label>1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á</label>
                <select id="shapeSelect">
                    <option value="heart">‚ù§Ô∏è ‡∏´‡∏±‡∏ß‡πÉ‡∏à</option>
                    <option value="1">‡πÄ‡∏•‡∏Ç 1</option>
                    <option value="2">‡πÄ‡∏•‡∏Ç 2</option>
                    <option value="3">‡πÄ‡∏•‡∏Ç 3</option>
                    <option value="4">‡πÄ‡∏•‡∏Ç 4</option>
                    <option value="5">‡πÄ‡∏•‡∏Ç 5</option>
                    <option value="6">‡πÄ‡∏•‡∏Ç 6</option>
                    <option value="7">‡πÄ‡∏•‡∏Ç 7</option>
                    <option value="8">‡πÄ‡∏•‡∏Ç 8</option>
                    <option value="9">‡πÄ‡∏•‡∏Ç 9</option>
                    <option value="0">‡πÄ‡∏•‡∏Ç 0</option>
                </select>
            </div>
            <div class="ui-group"><label>2. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÄ‡∏ô‡πâ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏±‡∏î‡πÜ)</label><input type="file" id="imageInput" multiple accept="image/*"></div>
            <div class="btn-row"><button class="btn-shuffle" onclick="shufflePhotos()">üîÄ ‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà</button><button class="btn-clear" onclick="clearPhotos()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ</button></div>
            <button class="btn-save" id="saveBtn" onclick="saveImage()">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ (Super Zoom)</button>
        </div>
    </div>

    <input type="file" id="singleReplaceInput" accept="image/*" style="display: none;">

<script>
    const patterns = {
        'heart': [".XX.XX.", "XXXXXXX", "XXXXXXX", "XXXXXXX", "XXXXXXX", ".XXXXX.", "..XXX..", "...X...", "......."],
        '1': ["...XX..", "..XXX..", ".XXXX..", "...XX..", "...XX..", "...XX..", "...XX..", ".XXXXXX", "......."],
        '2': [".XXXXX.", "XX...XX", ".....XX", "....XX.", "...XX..", "..XX...", ".XX....", "XXXXXXX", "......."],
        '3': [".XXXXX.", "XX...XX", ".....XX", "..XXXX.", ".....XX", ".....XX", "XX...XX", ".XXXXX.", "......."],
        '4': ["...XX..", "..XXX..", ".XXXX..", "XX..XX.", "XXXXXXX", "XXXXXXX", "....XX.", "....XX.", "......."],
        '5': ["XXXXXXX", "XX.....", "XX.....", "XXXXXX.", ".....XX", ".....XX", "XX...XX", ".XXXXX.", "......."],
        '6': ["..XXXX.", ".XX....", "XX.....", "XXXXXX.", "XX...XX", "XX...XX", "XX...XX", ".XXXXX.", "......."],
        '7': ["XXXXXXX", "XX...XX", "....XX.", "...XX..", "...XX..", "..XX...", "..XX...", "..XX...", "......."],
        '8': [".XXXXX.", "XX...XX", "XX...XX", ".XXXXX.", "XX...XX", "XX...XX", "XX...XX", ".XXXXX.", "......."],
        '9': [".XXXXX.", "XX...XX", "XX...XX", ".XXXXXX", ".....XX", ".....XX", "....XX.", "...XXX.", "......."],
        '0': [".XXXXX.", "XX...XX", "XX...XX", "XX...XX", "XX...XX", "XX...XX", "XX...XX", ".XXXXX.", "......."]
    };

    const grid = document.getElementById('gridContainer');
    const singleReplaceInput = document.getElementById('singleReplaceInput');
    let activeSlots = [];
    let sourceSlot = null;

    function build(shapeKey) {
        grid.innerHTML = ''; activeSlots = [];
        if(!patterns[shapeKey]) return;
        patterns[shapeKey].forEach(row => {
            row.split('').forEach(char => {
                const div = document.createElement('div');
                div.className = 'slot' + (char === 'X' ? ' active' : '');
                if(char === 'X') {
                    div.onclick = () => { sourceSlot = div; singleReplaceInput.click(); };
                    activeSlots.push(div);
                }
                grid.appendChild(div);
            });
        });
    }

    singleReplaceInput.onchange = (e) => {
        const file = e.target.files[0];
        if (file && sourceSlot) {
            const r = new FileReader();
            r.onload = (ev) => sourceSlot.style.backgroundImage = `url(${ev.target.result})`;
            r.readAsDataURL(file);
        }
        e.target.value = '';
    };

    document.getElementById('shapeSelect').onchange = (e) => build(e.target.value);
    
    document.getElementById('imageInput').onchange = async (e) => {
        const files = Array.from(e.target.files);
        for(let i=0; i<files.length && i<activeSlots.length; i++) {
            const url = await new Promise(res => {
                const r = new FileReader();
                r.onload = (ev) => res(ev.target.result);
                r.readAsDataURL(files[i]);
            });
            activeSlots[i].style.backgroundImage = `url(${url})`;
        }
    };

    function clearPhotos() { if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) activeSlots.forEach(s => s.style.backgroundImage = ''); }

    function shufflePhotos() {
        const imgs = activeSlots.map(s => s.style.backgroundImage).filter(i => i !== '');
        if (imgs.length < 2) return;
        for (let i = imgs.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [imgs[i], imgs[j]] = [imgs[j], imgs[i]];
        }
        activeSlots.forEach((s, idx) => s.style.backgroundImage = imgs[idx] || '');
    }

    function saveImage() {
        const btn = document.getElementById('saveBtn');
        const area = document.getElementById('a4-canvas');
        btn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î... (‡∏£‡∏≠ 3 ‡∏ß‡∏¥)"; btn.disabled = true;
        
        const originalTransform = area.style.transform;
        area.style.transform = "none"; // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏à‡∏£‡∏¥‡∏á (‡πÉ‡∏´‡∏ç‡πà‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á)

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏õ‡πá‡∏ô 2.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏†‡∏≤‡∏û‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á
        setTimeout(() => {
            html2canvas(area, { 
                scale: 4, // ‡∏Ñ‡∏π‡∏ì 4 ‡πÄ‡∏ó‡πà‡∏≤! (‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î)
                useCORS: true, 
                backgroundColor: "#ffffff", 
                width: 1190, height: 1684,
                logging: false,
                allowTaint: true,
                imageTimeout: 0, // ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ô‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `SuperZoom-${new Date().getTime()}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
                area.style.transform = originalTransform;
                btn.innerText = "üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ (Super Zoom)"; btn.disabled = false;
            }).catch(() => {
                alert("‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÑ‡∏°‡πà‡∏û‡∏≠ (‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ) ‡∏•‡∏≠‡∏á‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏•‡∏á‡∏Ñ‡∏£‡∏±‡∏ö");
                area.style.transform = originalTransform;
                btn.disabled = false;
            });
        }, 2500);
    }
    build('heart');
</script>
</body>
</html>
